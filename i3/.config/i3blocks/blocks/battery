#!/bin/bash
source $HOME/.cache/wal/colors.sh

# battery = percentage% chr/dis (remaining time)
BATTERY=$(acpi | sed 's/,//g; s/:[0-9]* / /g' | awk '{print $4" "$3" "$5""}')

# percentage = 0..100%
PERCENTAGE=$(echo $BATTERY | grep '^[0-9]*' -o)

sparks=$(spark 0 ${PERCENTAGE} 100)
GRAPH=${sparks:1:1}

# time = hh:mm
TIME=$(echo $BATTERY | awk '{print $3}')

# status = Charging/Discharging
STATUS=$(echo $BATTERY | awk '{print $2}')

if [[ "$STATUS" == "Charging" ]]; then
    OUTPUT="âš¡$PERCENTAGE% $GRAPH ($TIME)"
else  # discharging
    OUTPUT="$PERCENTAGE% $GRAPH ($TIME)"
fi


case $PERCENTAGE in
    9[0-9] | 100)  # green
        echo "<span color='$color2'>$OUTPUT</span>"
        ;;
    2[0-5])  # yellow
        echo "<span color='$color3'>$OUTPUT</span>"
        ;;
    1[0-9])  # red
        echo "<span color='$color1'>$OUTPUT</span>"
        ;;
    [0-9])
        if [[ "$STATUS" == "Discharging" ]]; then  # red background
            echo "<span bgcolor='red' color='black'>$OUTPUT</span>"
        else
            echo "<span color='$color1'>$OUTPUT</span>"
        fi
        ;;
    *)  # white
        echo $OUTPUT
esac
